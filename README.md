\# 奇趣乐园模拟器

\[!\[Python Version](https://img.shields.io/badge/python-3.10%2B-blue)](https://www.python.org/)

\[!\[License](https://img.shields.io/badge/license-MIT-green)](LICENSE)

\[!\[Tests Passing](https://img.shields.io/badge/tests-passing-brightgreen)](test\_simulation.py)

\[!\[Dependencies](https://img.shields.io/badge/deps-up%20to%20date-orange)](requirements.txt)





\## 项目简介

奇趣乐园模拟器是一款 \*\*可视化乐园运营模拟工具\*\*，专为乐园运营者设计。通过 16×16 网格地图、实时数据图表、游客行为模拟，直观展示设施排队情况、利用率等核心指标，支持动态调整设施参数（容量、运行时长等），辅助运营决策优化（如设施布局调整、客流疏导）。





\## 项目截图

| 主界面概览 | 设施管理 |

|------------|----------|

| !\[主界面截图](screenshots/main_interface.png) | 
!\[设施管理](screenshots/facility_management.png) |
| 游客模拟 | 数据可视化 |

| !\[游客模拟](screenshots/visitor_simulation.png) | !\[数据可视化](screenshots/data_visualization.png) |





\## 功能特性

\### 核心功能 🚀

\- 🗺️ \*\*16×16 网格地图\*\*：用 emoji 区分设施类型（🎢 过山车、🎡 摩天轮等），直观展示设施位置与状态

\- 🏟️ \*\*设施动态管理\*\*：支持新增/删除设施，自定义名称、容量、单次运行时长，拖拽调整位置（自动避开已占用格子）

\- 📊 \*\*实时状态监控\*\*：设施排队人数（>10人红色提醒）、运行/空闲状态、总服务游客数实时更新

\- 👥 \*\*游客行程模拟\*\*：基于栈结构实现游客行程单，按预设计划移动、排队、游玩，头顶气泡显示实时状态（如“下一站：摩天轮”）

\- 📈 \*\*多维度数据可视化\*\*：

&nbsp; - 排队长度折线图：跟踪各设施排队人数变化

&nbsp; - 等待时间热力图：按时间段展示不同设施的平均等待时间

&nbsp; - 设施利用率仪表盘：用红（<50%）、黄（50%-80%）、绿（>80%）区分利用率等级



\### 进阶功能 ⭐

\- 🔄 \*\*操作撤销/重做\*\*：支持最多 5 步操作回滚（新增、删除、移动设施）

\- 📥 \*\*数据导出\*\*：模拟数据导出为 Excel，包含设施基础信息、实时排队数据、利用率历史

\- 🔧 \*\*布局自动保存\*\*：设施位置变更后自动写入 `layout.json`，下次启动自动加载

\- 👨👩👧👦 \*\*批量游客生成\*\*：自定义游客数量，在乐园入口批量生成，支持 50+ 游客同时模拟





\## 快速开始

\### 1. 环境要求

\- 操作系统：Windows/macOS/Linux

\- Python 版本：3.10 及以上

\- 依赖库：matplotlib、numpy、pandas、openpyxl、pygame



\### 2. 安装依赖

克隆仓库后，在项目根目录执行以下命令安装依赖：

```bash

pip install -r requirements.txt

```



\### 3. 启动程序

```bash

python main.py

```

> 📌 首次启动说明：  

> - 自动创建 5 个默认设施（极速过山车、幸福摩天轮、旋转木马、激情碰碰车、海盗船）  

> - 设施布局保存在 `layout.json`，后续修改会实时更新该文件  





\## 操作指南

\### 1. 设施管理

1\. \*\*新增设施\*\*：

&nbsp;  - 在左侧「控制面板」→「设施管理」中选择设施类型（如“过山车”）

&nbsp;  - 点击「新增设施」，在弹窗中设置：

&nbsp;    - 设施名称（默认如“过山车6”，需唯一）

&nbsp;    - 容量（单次可容纳人数，默认值按设施类型预设）

&nbsp;    - 运行时长（单次运行秒数，默认值按设施类型预设）

&nbsp;  - 点击「确定」，设施会在地图空白格子生成

2\. \*\*删除设施\*\*：

&nbsp;  - 点击「删除选中设施」，若仅1个设施则直接删除；若多个设施，输入目标设施名称即可

3\. \*\*调整位置\*\*：

&nbsp;  - 鼠标点击地图上的设施，按住拖拽到空白格子，松开后自动保存新位置



\### 2. 游客管理

1\. 在左侧「控制面板」→「游客管理」中输入游客数量（需≥1）

2\. 点击「生成游客」，游客会在地图左上角（入口位置）生成

3\. 游客行为逻辑：

&nbsp;  - 按行程单顺序前往目标设施，移动过程中状态为“自由”

&nbsp;  - 到达设施后进入排队，状态变为“等待”

&nbsp;  - 设施启动运行后，游客进入“游玩”状态

&nbsp;  - 游玩结束后，更新行程单，前往下一个目标（无目标则状态变为“行程结束”）



\### 3. 模拟控制

\- \*\*开始/暂停模拟\*\*：点击「开始模拟」启动实时模拟，点击「暂停模拟」停止更新

\- \*\*撤销/重做\*\*：

&nbsp; - 「撤销」：回滚上一步操作（如撤销新增的设施、恢复删除的设施）

&nbsp; - 「重做」：恢复已撤销的操作（仅在撤销后可用）

\- \*\*数据导出\*\*：点击「导出Excel」，数据会保存为 `simulation\_20240520\_143000.xlsx`（文件名含时间戳），包含3个工作表：

&nbsp; - 设施基础信息：名称、类型、容量、坐标、当前状态等

&nbsp; - 实时排队数据：各时间点设施的排队人数

&nbsp; - 设施利用率：总运行/空闲时间、利用率百分比及历史变化



\### 4. 数据可视化

1\. 在左侧「控制面板」→「操作控制」中，通过「图表设施」下拉框选择查看目标（“所有设施”或单个设施）

2\. 右侧「数据可视化」标签页切换：

&nbsp;  - 「排队长度」：折线图展示实时排队人数变化（x轴为模拟时间，格式“分:秒”）

&nbsp;  - 「等待时间热力图」：按“0-10分钟”等时间段展示各设施平均等待时间

&nbsp;  - 「设施利用率」：卡片式展示各设施当前利用率，颜色区分等级





\## 文件结构

```

奇趣乐园/

├─ main.py                # 程序入口，初始化Tkinter根窗口并启动GUI

├─ gui.py                 # 核心GUI逻辑：地图绘制、图表渲染、按钮事件绑定

├─ facility.py            # 设施类+工厂模式：Facility（设施逻辑）、FacilityFactory（创建设施）

├─ visitor.py             # 游客类+生成器：Visitor（游客行为）、VisitorGenerator（批量生成）

├─ data\_structures.py     # 数据结构工具：队列（排队）、栈（行程单）、命令栈（撤销/重做）

├─ utils.py               # 通用工具：Excel导出、JSON读写、位置计算、颜色配置

├─ test\_simulation.py     # 单元测试：数据结构、设施逻辑、游客行程等核心功能测试

├─ layout.json            # 设施布局配置：自动保存设施名称、坐标、参数等信息

├─ requirements.txt       # 依赖库列表：matplotlib==3.8.0、numpy==1.26.0等

├─ LICENSE                # MIT许可证文件

├─ README.md              # 项目说明文档（当前文件）

└─ screenshots/           # 演示图片目录：存放主界面、操作演示等截图（需用户自行补充）

```





\## 常见问题（FAQ）

1\. \*\*Q：启动报错“ModuleNotFoundError: No module named 'xxx'”？\*\*  

&nbsp;  A：未安装依赖库，执行 `pip install -r requirements.txt` 即可（确保Python版本≥3.10）。



2\. \*\*Q：新增设施时弹窗提示“设施名称已存在”？\*\*  

&nbsp;  A：设施名称需唯一，修改名称后重试（如将“过山车6”改为“极速过山车2”）。



3\. \*\*Q：拖拽设施时无法移动到目标格子？\*\*  

&nbsp;  A：目标格子已被其他设施占用，选择空白格子即可。



4\. \*\*Q：Excel导出失败或文件无法打开？\*\*  

&nbsp;  A：检查2点：① 确保至少有1个设施（无设施则无数据可导出）；② 升级openpyxl：`pip install --upgrade openpyxl`。



5\. \*\*Q：模拟运行时地图刷新卡顿？\*\*  

&nbsp;  A：减少同时模拟的游客数量（建议≤50人），或关闭其他占用资源的程序。





\## 贡献指南

欢迎参与项目优化，贡献流程如下：

1\. \*\*Fork 仓库\*\*：点击 GitHub 仓库右上角「Fork」按钮，创建个人分支

2\. \*\*创建开发分支\*\*：

&nbsp;  ```bash

&nbsp;  git checkout -b feature/新增功能名称  # 如 feature/新增游客满意度指标

&nbsp;  # 或 bugfix/修复问题描述  # 如 bugfix/修复设施利用率计算错误

&nbsp;  ```

3\. \*\*提交代码\*\*：

&nbsp;  ```bash

&nbsp;  git add .

&nbsp;  git commit -m "描述修改内容：如新增游客满意度指标，优化排队时间计算"

&nbsp;  git push origin 分支名称

&nbsp;  ```

4\. \*\*提交 Pull Request\*\*：在 GitHub 个人分支页面点击「Compare \& pull request」，说明修改内容，等待审核



\## 许可证

本项目采用 \*\*MIT 许可证\*\* 开源，允许：

\- 商用、修改、分发本项目代码

\- 基于本项目进行二次开发









> 📌 提示：请将演示图片（主界面、设施管理、游客模拟、数据可视化）放入 `screenshots/` 目录，确保图片命名与 README 中的引用一致（如 `main\_interface.png`），GitHub 会自动渲染显示。

